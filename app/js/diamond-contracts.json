/**
 * Diamond Contracts ABI Definitions
 * 
 * This file contains the ABI (Application Binary Interface) definitions for diamond contracts
 * used in the Fair Stake Token system. These ABIs allow JavaScript to interact with the
 * smart contracts deployed on the TRON blockchain.
 */

// Diamond合约ABI - 包含核心钻石模式功能
const DIAMOND_ABI = [
    // diamondCut函数 - 核心升级功能
    {
        "constant": false,
        "inputs": [
            {
                "components": [
                    {
                        "name": "facetAddress",
                        "type": "address"
                    },
                    {
                        "name": "action",
                        "type": "uint8"
                    },
                    {
                        "name": "functionSelectors",
                        "type": "bytes4[]"
                    }
                ],
                "name": "facetCuts",
                "type": "tuple[]"
            },
            {
                "name": "init",
                "type": "address"
            },
            {
                "name": "calldata",
                "type": "bytes"
            }
        ],
        "name": "diamondCut",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    
    // owner函数 - 获取合约所有者
    {
        "constant": true,
        "inputs": [],
        "name": "owner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // transferOwnership函数 - 转移合约所有权
    {
        "constant": false,
        "inputs": [
            {
                "name": "newOwner",
                "type": "address"
            }
        ],
        "name": "transferOwnership",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    
    // facets函数 - 获取所有facets
    {
        "constant": true,
        "inputs": [],
        "name": "facets",
        "outputs": [
            {
                "components": [
                    {
                        "name": "facetAddress",
                        "type": "address"
                    },
                    {
                        "name": "functionSelectors",
                        "type": "bytes4[]"
                    }
                ],
                "name": "",
                "type": "tuple[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // facetFunctionSelectors函数 - 获取特定facet的功能选择器
    {
        "constant": true,
        "inputs": [
            {
                "name": "_facet",
                "type": "address"
            }
        ],
        "name": "facetFunctionSelectors",
        "outputs": [
            {
                "name": "",
                "type": "bytes4[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // facetAddresses函数 - 获取所有facet地址
    {
        "constant": true,
        "inputs": [],
        "name": "facetAddresses",
        "outputs": [
            {
                "name": "",
                "type": "address[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // facetAddress函数 - 获取特定功能选择器的facet地址
    {
        "constant": true,
        "inputs": [
            {
                "name": "_functionSelector",
                "type": "bytes4"
            }
        ],
        "name": "facetAddress",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // supportsInterface函数 - ERC165接口支持检查
    {
        "constant": true,
        "inputs": [
            {
                "name": "interfaceId",
                "type": "bytes4"
            }
        ],
        "name": "supportsInterface",
        "outputs": [
            {
                "name": "",
                "type": "bool"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    
    // DiamondCut事件 - 记录切割操作
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "name": "_diamondCut",
                "type": "tuple[]"
            },
            {
                "indexed": true,
                "name": "_init",
                "type": "address"
            },
            {
                "indexed": false,
                "name": "_calldata",
                "type": "bytes"
            }
        ],
        "name": "DiamondCut",
        "type": "event"
    },
    
    // OwnershipTransferred事件 - 记录所有权转移
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "name": "previousOwner",
                "type": "address"
            },
            {
                "indexed": true,
                "name": "newOwner",
                "type": "address"
            }
        ],
        "name": "OwnershipTransferred",
        "type": "event"
    }
];

// DiamondLoupe接口ABI - 用于查询钻石结构
const DIAMOND_LOUPE_ABI = [
    {
        "constant": true,
        "inputs": [],
        "name": "facets",
        "outputs": [
            {
                "components": [
                    {
                        "name": "facetAddress",
                        "type": "address"
                    },
                    {
                        "name": "functionSelectors",
                        "type": "bytes4[]"
                    }
                ],
                "name": "",
                "type": "tuple[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "_facet",
                "type": "address"
            }
        ],
        "name": "facetFunctionSelectors",
        "outputs": [
            {
                "name": "",
                "type": "bytes4[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "facetAddresses",
        "outputs": [
            {
                "name": "",
                "type": "address[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "_functionSelector",
                "type": "bytes4"
            }
        ],
        "name": "facetAddress",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }
];

// Ownership接口ABI - 用于所有权管理
const OWNERSHIP_ABI = [
    {
        "constant": true,
        "inputs": [],
        "name": "owner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "newOwner",
                "type": "address"
            }
        ],
        "name": "transferOwnership",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "name": "previousOwner",
                "type": "address"
            },
            {
                "indexed": true,
                "name": "newOwner",
                "type": "address"
            }
        ],
        "name": "OwnershipTransferred",
        "type": "event"
    }
];

// 常见功能选择器常量
const FUNCTION_SELECTORS = {
    // DiamondCut功能选择器
    DIAMOND_CUT: "0x1f931c1c",
    
    // DiamondLoupe功能选择器
    FACETS: "0x7a0ed627",
    FACET_FUNCTION_SELECTORS: "0xadfca15e",
    FACET_ADDRESSES: "0x52ef6b2c",
    FACET_ADDRESS: "0xcdffacc6",
    
    // Ownership功能选择器
    OWNER: "0x8da5cb5b",
    TRANSFER_OWNERSHIP: "0xf2fde38b",
    
    // ERC165功能选择器
    SUPPORTS_INTERFACE: "0x01ffc9a7",
    
    // 接口ID
    DIAMOND_LOUPE_INTERFACE_ID: "0x48e2b093",
    ERC165_INTERFACE_ID: "0x01ffc9a7"
};

// 操作类型常量
const CUT_ACTION = {
    ADD: 0,
    REPLACE: 1,
    REMOVE: 2
};

// 导出所有ABI和常量
window.DIAMOND_ABI = DIAMOND_ABI;
window.DIAMOND_LOUPE_ABI = DIAMOND_LOUPE_ABI;
window.OWNERSHIP_ABI = OWNERSHIP_ABI;
window.FUNCTION_SELECTORS = FUNCTION_SELECTORS;
window.CUT_ACTION = CUT_ACTION;

// 提供一个简单的功能选择器计算器
function calculateSelector(functionSignature) {
    // 在实际应用中，这应该使用tronWeb.utils.sha3
    // 这里提供一个简化版本作为示例
    console.warn('calculateSelector: 这是一个示例实现，请在生产环境中使用tronWeb.utils.sha3');
    return '0x' + '00000000'.substring(0, 8);
}

// 导出功能选择器计算器
window.calculateSelector = calculateSelector;

/**
 * 使用示例：
 * 
 * // 初始化钻石合约实例
 * const diamondContract = new tronWeb.contract(DIAMOND_ABI, diamondAddress);
 * 
 * // 获取所有facets
 * const facets = await diamondContract.facets().call();
 * 
 * // 执行diamondCut操作
 * const tx = await diamondContract.diamondCut(
 *   [{
 *     facetAddress: facetAddress,
 *     action: CUT_ACTION.ADD,
 *     functionSelectors: ['0x12345678', '0x87654321']
 *   }],
 *   '0x0000000000000000000000000000000000000000',
 *   '0x'
 * ).send({
 *   feeLimit: 10000000,
 *   callValue: 0
 * });
 */