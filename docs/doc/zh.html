<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FairStakeToken 合约 API 文档</title>
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f5f7fa; 
        }
        .header-section { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 3rem 0; 
            margin-bottom: 2rem;
        }
        .header-section h1 { 
            font-size: 2.5rem; 
            font-weight: 700;
        }
        .content-card { 
            background: white; 
            border-radius: 8px; 
            padding: 2rem; 
            margin-bottom: 2rem; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .content-card:hover { 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }
        .function-def { 
            font-family: 'Courier New', monospace; 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        .event-def { 
            font-family: 'Courier New', monospace; 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 1rem;
            background-color: #e7f3ff;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 4px solid #2196F3;
        }
        .error-def { 
            font-family: 'Courier New', monospace; 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 1rem;
            background-color: #fff3cd;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
        }
        .modifier-def { 
            font-family: 'Courier New', monospace; 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 1rem;
            background-color: #d4edda;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 4px solid #28a745;
        }
        .section-title { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: #2c3e50; 
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem; 
            border-bottom: 3px solid #667eea;
        }
        .parameter-list { 
            list-style: none; 
            padding-left: 0;
        }
        .parameter-list li { 
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .code-block { 
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
        .nav-link { 
            font-weight: 500; 
            transition: color 0.2s;
        }
        .nav-link:hover { 
            color: #667eea !important;
        }
        .language-switch { 
            margin-left: 1rem;
        }
        .language-switch button { 
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .language-switch button:hover { 
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .content { 
            line-height: 1.6;
        }
        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 { 
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        .content p { 
            margin-bottom: 1em;
        }
        .content ul, .content ol { 
            margin-bottom: 1em;
        }
        .tag { 
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar is-white" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="/index.html">
                <img src="https://fairdao.space/static/fair-logo.34a90480.png" alt="FairDAO" height="28">
            </a>
            
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarMenu" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item nav-link" href="#overview">概述</a>
                <a class="navbar-item nav-link" href="#contract">合约信息</a>
                <a class="navbar-item nav-link" href="#events">事件</a>
                <a class="navbar-item nav-link" href="#functions">函数</a>
                <a class="navbar-item nav-link" href="#modifiers">修饰器</a>
                <a class="navbar-item nav-link" href="#errors">错误类型</a>
            </div>
            
            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="language-switch">
                        <button class="button is-primary" onclick="switchLanguage('zh')">
                            中文
                        </button>
                        <button class="button is-light" onclick="switchLanguage('en')">
                            English
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header --<section class="header-section">
        <div class="container">
            <h1 class="title">FairStakeToken 合约 API 文档</h1>
            <p class="subtitle">质押与通证兑换协议</p>
        </div>
    </section>

    <!-- Main Content --<div class="container">
        <div class="columns">
            <div class="column is-three-quarters is-offset-one-eighth">
                
                <!-- Overview --<section id="overview" class="content-card">
                    <h2 class="section-title">概述</h2>
                    <div class="content">
                        <p>FairStakeToken 合约是基于 TRON 区块链的通证质押与兑换协议，提供以下核心功能：</p>
                        <ul>
                            <li>通证质押与奖励系统</li>
                            <li>Fair Reward (FR) 与 FairToken 兑换机制</li>
                            <li>提前赎回机制及罚金率计算</li>
                            <li>模块化函数暂停控制</li>
                            <li>多维度奖励计算与发放</li>
                        </ul>
                    </div>
                </section>

                <!-- Contract Basic Information --<section id="contract" class="content-card">
                    <h2 class="section-title">合约基础信息</h2>
                    <div class="content">
                        <table class="table is-striped is-hoverable is-fullwidth">
                            <tbody>
                                <tr>
                                    <th>合约名称</th>
                                    <td>FairStakeToken</td>
                                </tr>
                                <tr>
                                    <th>继承关系</th>
                                    <td>ERC20</td>
                                </tr>
                                <tr>
                                    <th>编译版本</th>
                                    <td>^0.8.23</td>
                                </tr>
                                <tr>
                                    <th>许可证</th>
                                    <td>MIT</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Error Types --<section id="errors" class="content-card">
                    <h2 class="section-title">错误类型</h2>
                    <div class="content">
                        <div class="mb-4">
                            <div class="error-def">TransferFailed()</div>
                            <p class="mt-2">当通证转账失败时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">InsufficientFROnChain()</div>
                            <p class="mt-2">当链上 FR 奖励不足时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">AddressIsZero()</div>
                            <p class="mt-2">当地址为零地址时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">AmountIsZero()</div>
                            <p class="mt-2">当金额为零时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">UserNotStaked()</div>
                            <p class="mt-2">当用户未进行任何质押时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">UserAlreadyStaked()</div>
                            <p class="mt-2">当用户已进行质押时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">UnstakeRequestNotReady()</div>
                            <p class="mt-2">当赎回请求未就绪时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">UnstakeRequestAlreadyExists()</div>
                            <p class="mt-2">当用户已存在待处理的赎回请求时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">NoPendingUnstakeRequest()</div>
                            <p class="mt-2">当不存在待处理的赎回请求时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">ExchangeLimitExceeded()</div>
                            <p class="mt-2">当兑换金额超过限制时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">ExchangeAmountExceedsOnePercentLimit()</div>
                            <p class="mt-2">当单笔兑换金额在 48 小时内超过剩余额度的 1% 时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">ContractIsPaused()</div>
                            <p class="mt-2">当合约函数暂停时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">OnlyOwner()</div>
                            <p class="mt-2">当只有合约所有者可以调用该函数时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">TokenExchangeTypeInvalid()</div>
                            <p class="mt-2">当通证兑换类型无效时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">BurnAmountTooLarge()</div>
                            <p class="mt-2">当销毁金额过大时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">RewardAmountZero()</div>
                            <p class="mt-2">当奖励金额为零时抛出的错误。</p>
                        </div>
                        <div class="mb-4">
                            <div class="error-def">NotEnoughTokensToUnstake()</div>
                            <p class="mt-2">当用户没有足够的通证可以赎回时抛出的错误。</p>
                        </div>
                    </div>
                </section>

                <!-- Events --<section id="events" class="content-card">
                    <h2 class="section-title">事件</h2>
                    <div class="content">
                        <div class="mb-4">
                            <div class="event-def">event Staked(address indexed user, uint256 amount, uint256 rewardAmount)</div>
                            <p class="mt-2">当用户成功质押通证时触发的事件。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>user</code> - 质押用户地址</li>
                                <li><code>amount</code> - 质押通证数量</li>
                                <li><code>rewardAmount</code> - FR 奖励数量</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="event-def">event UnstakeRequested(address indexed user, uint256 amount, uint256 timestamp)</div>
                            <p class="mt-2">当用户成功请求赎回时触发的事件。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>user</code> - 赎回用户地址</li>
                                <li><code>amount</code> - 赎回通证数量</li>
                                <li><code>timestamp</code> - 请求时间戳</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="event-def">event Unstaked(address indexed user, uint256 fairAmount, uint256 fee)</div>
                            <p class="mt-2">当用户成功赎回通证时触发的事件。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>user</code> - 赎回用户地址</li>
                                <li><code>fairAmount</code> - 获得的 FR 数量</li>
                                <li><code>fee</code> - 提前赎回的罚金数量</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="event-def">event RewardClaimed(address indexed user, uint256 amount)</div>
                            <p class="mt-2">当用户成功申领奖励时触发的事件。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>user</code> - 申领奖励的用户地址</li>
                                <li><code>amount</code> - 申领的 FR 奖励数量</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="event-def">event TokenExchanged(address indexed user, uint256 frAmount, uint256 tokenAmount, uint256 timestamp)</div>
                            <p class="mt-2">当用户成功兑换通证时触发的事件。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>user</code> - 兑换通证的用户地址</li>
                                <li><code>frAmount</code> - 支付的 FR 数量</li>
                                <li><code>tokenAmount</code> - 获得的通证数量</li>
                                <li><code>timestamp</code> - 兑换时间戳</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Functions --<section id="functions" class="content-card">
                    <h2 class="section-title">函数</h2>
                    <div class="content">
                        <div class="mb-4">
                            <div class="function-def">function stake(uint256 amount) external</div>
                            <p class="mt-2">用户质押通证的主要函数。</p>
                            <p><strong>参数：</strong> <code>amount</code> - 质押的通证数量（TRX 单位）</p>
                            <p><strong>操作流程：</strong></p>
                            <ul>
                                <li>验证输入参数</li>
                                <li>计算用户的 FR 奖励（含未领取奖励）</li>
                                <li>处理用户质押操作</li>
                                <li>更新质押记录</li>
                                <li>触发 Staked 事件</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function requestUnstake(uint256 amount) external</div>
                            <p class="mt-2">用户请求赎回质押的通证。</p>
                            <p><strong>参数：</strong> <code>amount</code> - 赎回的通证数量</p>
                            <p><strong>功能特点：</strong></p>
                            <ul>
                                <li>需要 15-60 天等待期，具体天数根据质押金额计算</li>
                                <li>计算用户未领取的 FR 奖励</li>
                                <li>设置赎回请求到期时间</li>
                                <li>更新用户质押信息</li>
                                <li>触发 UnstakeRequested 事件</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function unstake() external</div>
                            <p class="mt-2">用户执行实际的赎回操作。</p>
                            <p><strong>功能特点：</strong></p>
                            <ul>
                                <li>检查赎回请求是否到期</li>
                                <li>计算提前赎回的罚金率（每天 0.2%）</li>
                                <li>执行通证转账</li>
                                <li>更新用户质押记录</li>
                                <li>触发 Unstaked 事件</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function claimReward() external</div>
                            <p class="mt-2">用户申领未领取的 FR 奖励。</p>
                            <p><strong>操作流程：</strong></p>
                            <ul>
                                <li>计算已获得的 FR 奖励</li>
                                <li>更新用户奖励记录</li>
                                <li>触发 RewardClaimed 事件</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function exchangeFRForToken(uint256 frAmount, TokenTransferType transferType) external</div>
                            <p class="mt-2">核心通证兑换函数，允许用户用 FR 兑换 FairToken。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>frAmount</code> - 要兑换的 FR 数量</li>
                                <li><code>transferType</code> - 转账类型（即时或其他）</li>
                            </ul>
                            <p><strong>重要限制：</strong></p>
                            <ul>
                                <li><strong>48 小时单笔兑换限制</strong>：48 小时内单笔兑换不超过剩余额度的 1%</li>
                                <li>检查合约是否暂停</li>
                                <li>验证输入参数</li>
                                <li>计算兑换汇率和兑换数量</li>
                                <li>更新用户兑换记录</li>
                                <li>执行通证转账</li>
                                <li>触发 TokenExchanged 事件</li>
                            </ul>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function getUserStakeInfo(address user) external view returns (StakeInfo memory)</div>
                            <p class="mt-2">获取用户的质押信息。</p>
                            <p><strong>参数：</strong> <code>user</code> - 用户地址</p>
                            <p><strong>返回值：</strong> <code>StakeInfo</code> - 用户质押信息结构体</p>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function burn(uint256 amount) external</div>
                            <p class="mt-2">销毁指定数量的通证。</p>
                            <p><strong>参数：</strong> <code>amount</code> - 要销毁的通证数量</p>
                            <p><strong>权限：</strong> 只有合约所有者可以调用</p>
                        </div>
                        <div class="mb-4">
                            <div class="function-def">function setTokenExchangeRate(uint256 rate, uint256 maxExchangeAmountPerDay, TokenTransferType transferType) external</div>
                            <p class="mt-2">设置通证兑换汇率和每日最大兑换量。</p>
                            <p><strong>参数：</strong></p>
                            <ul class="parameter-list">
                                <li><code>rate</code> - 兑换汇率（每单位通证的 FR 数量）</li>
                                <li><code>maxExchangeAmountPerDay</code> - 每日最大兑换量</li>
                                <li><code>transferType</code> - 转账类型</li>
                            </ul>
                            <p><strong>权限：</strong> 只有合约所有者可以调用</p>
                        </div>
                    </div>
                </section>

                <!-- Modifiers --<section id="modifiers" class="content-card">
                    <h2 class="section-title">修饰器</h2>
                    <div class="content">
                        <div class="mb-4">
                            <div class="modifier-def">modifier isOwner()</div>
                            <p class="mt-2">限制只有合约所有者可以调用的修饰器。</p>
                        </div>
                        <div class="mb-4">
                            <div class="modifier-def">modifier whenModuleNotPaused(FunctionModule module)</div>
                            <p class="mt-2">检查指定函数模块是否未暂停的修饰器。</p>
                            <p><strong>参数：</strong> <code>module</code> - 函数模块类型</p>
                        </div>
                        <div class="mb-4">
                            <div class="modifier-def">modifier nonReentrant()</div>
                            <p class="mt-2">防止重入攻击的修饰器。</p>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <!-- Footer --<footer class="footer mt-8">
        <div class="container">
            <div class="content has-text-centered">
                <p>FairStakeToken 合约 API 文档 &copy; 2025</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="/js/doc.js"></script>
    <script>
        // Language switch function
        function switchLanguage(language) {
            if (language === 'en') {
                window.location.href = 'en.html';
            } else {
                window.location.href = 'zh.html';
            }
        }
        
        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>